<!DOCTYPE html>
<html>
<head>
    <title>YouTube Audio Player</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .player-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        audio {
            width: 100%;
            margin: 20px 0;
        }
        .info {
            margin: 20px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="player-container">
        <h1>YouTube Audio Player</h1>
        <div class="info">
            <p><strong>Title:</strong> <span id="title"></span></p>
            <p><strong>Author:</strong> <span id="author"></span></p>
            <p><strong>Format:</strong> <span id="format"></span></p>
            <p><strong>Bitrate:</strong> <span id="bitrate"></span></p>
        </div>
        <audio id="audioPlayer" controls>
            Your browser does not support the audio element.
        </audio>
    </div>

    <script>
        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const streamData = JSON.parse(decodeURIComponent(urlParams.get('data') || '{}'));
        
        // Update player info
        document.getElementById('title').textContent = streamData.title || 'Unknown Title';
        document.getElementById('author').textContent = streamData.author || 'Unknown Author';
        document.getElementById('format').textContent = streamData.format || 'Unknown Format';
        document.getElementById('bitrate').textContent = streamData.bitrate || 'Unknown Bitrate';
        
        // Set up audio player
        const audioPlayer = document.getElementById('audioPlayer');
        
        // Create a MediaSource
        const mediaSource = new MediaSource();
        audioPlayer.src = URL.createObjectURL(mediaSource);
        
        mediaSource.addEventListener('sourceopen', () => {
            const sourceBuffer = mediaSource.addSourceBuffer(streamData.mime_type);
            
            // Fetch the audio stream with proper headers
            fetch(streamData.url, {
                headers: {
                    'User-Agent': 'Mozilla/5.0 (Linux; Android 13; SM-S908B) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.6099.144 Mobile Safari/537.36',
                    'Accept': '*/*',
                    'Accept-Language': 'en-US,en;q=0.9',
                    'Accept-Encoding': 'gzip, deflate, br',
                    'Range': 'bytes=0-',
                    'Sec-Fetch-Mode': 'cors',
                    'Sec-Fetch-Site': 'cross-site',
                    'Sec-Fetch-Dest': 'audio',
                    'Referer': 'https://www.youtube.com/',
                    'Origin': 'https://www.youtube.com'
                }
            })
            .then(response => response.arrayBuffer())
            .then(data => {
                sourceBuffer.addEventListener('updateend', () => {
                    if (!sourceBuffer.updating && mediaSource.readyState === 'open') {
                        mediaSource.endOfStream();
                    }
                });
                
                sourceBuffer.appendBuffer(data);
            })
            .catch(error => {
                console.error('Error fetching audio:', error);
                alert('Error loading audio stream. Please try again.');
            });
        });
    </script>
</body>
</html> 